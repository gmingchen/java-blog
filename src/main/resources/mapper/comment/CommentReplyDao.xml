<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.slipper.modules.comment.dao.CommentReplyDao">

    <resultMap type="com.slipper.modules.comment.entity.CommentReplyEntity" id="commentReplyMap">
        <result property="id" column="id"/>
        <result property="content" column="content"/>
        <result property="commentId" column="comment_id"/>
        <result property="fromUserId" column="from_user_id"/>
        <result property="toUserId" column="to_user_id"/>
        <result property="commentReplyId" column="comment_reply_id"/>
        <result property="type" column="type"/>
        <result property="type" column="type"/>
        <result property="createdAt" column="created_at"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

<!--    IPage<CommentReplyDto> queryPage(Page<CommentReplyDto> page, @Param("id") int id);-->
    <select id="queryPage" resultType="com.slipper.modules.comment.model.dto.CommentReplyDto">
        SELECT cr.id, cr.content, cr.comment_id, cr.comment_reply_id, cr.type, cr.created_at,
               fu.id AS from_user_id, fu.username AS from_username, fu.nickname AS from_nickname, fu.avatar AS from_avatar, fu.sex AS from_sex,
               tu.id AS to_user_id, tu.username AS to_username, tu.nickname AS to_nickname, tu.avatar AS to_avatar, fu.sex AS to_sex
        FROM comment__reply AS cr
        LEFT JOIN comment AS c ON c.id = cr.comment_id
        LEFT JOIN user AS fu ON fu.id = cr.from_user_id
        LEFT JOIN user AS tu ON tu.id = cr.to_user_id
        WHERE cr.deleted = 0 AND cr.comment_id = #{id}
        ORDER BY cr.created_at DESC
    </select>
</mapper>